name: trudag-report

on:
  push:
    branches: [ development, main ]
  pull_request:
    branches: [ development, main ]

jobs:
  build-and-generate-report:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install trudag gravitz

      - name: Run simple validators
        run: |
          python docs/TSF/tsf_implementation/scripts/validators.py --items-dir docs/TSF/tsf_implementation/items --dotstop ./.dotstop.dot

      - name: Generate .dotstop.dot (trudag init)
        run: |
          trudag init --root docs/TSF/tsf_implementation --output .dotstop.dot

      - name: Lint and create items (dry-run)
        # These are template commands; review before enabling publish steps
        run: |
          trudag manage lint --dotstop .dotstop.dot || true
          # Example: create items/links from generated sources if needed
          # trudag manage create-item --type evidence --id EVID-L0-01 --title "Example" --text "..."

      - name: Score (dry-run)
        run: |
          trudag score --dotstop .dotstop.dot || true

      - name: Publish (disabled by default)
        if: github.event_name == 'workflow_dispatch'
        run: |
          # Only run when triggered manually after review. Publishing may require
          # repository tokens or access. Replace with secure publish settings.
          trudag publish --dotstop .dotstop.dot
