# TSF Implementation Guide â€” SEA:ME Team 6

This document describes the TSF (Trustable Software Framework) implementation for the PiRacer Warm-Up project, including the unified automation script, TruDAG integration, and validation workflows.

**Last Updated:** February 2026  
**Authors:** SEA-ME Team 6

---

## Table of Contents

1. [Prerequisites](#prerequisites)
2. [Project Structure](#project-structure)
3. [Quick Start Commands](#quick-start-commands)
4. [Main Automation Script](#main-automation-script)
5. [Workflow Stages](#workflow-stages)
6. [TruDAG Integration](#trudag-integration)
7. [Validators](#validators)
8. [Symlinks Explained](#symlinks-explained)
9. [CI/CD Integration](#cicd-integration)
10. [Published Reports](#published-reports)
11. [Troubleshooting](#troubleshooting)

---

## Prerequisites

- **Python 3.9+** with virtual environment
- **trudag** installed (`pip install trudag`)
- **graphviz** (`dot`) for rendering graph.dot
- **gh CLI** with Copilot extension (optional, for AI generation)

### Virtual Environment Setup

```bash
# Activate the project virtual environment
source .venv/bin/activate

# Verify trudag is available
trudag --help
```

---

## Project Structure

```
SEA-ME_Team6_2025-26/
â”œâ”€â”€ .venv/                         # Python virtual environment (ONLY ONE)
â”œâ”€â”€ .dotstop.dot                   # Symlink â†’ docs/TSF/tsf_implementation/.dotstop.dot
â”œâ”€â”€ .dotstop_extensions/           # Custom trudag extensions
â”‚   â”œâ”€â”€ __init__.py                # Exports all references and validators
â”‚   â”œâ”€â”€ references.py              # FileReference, UrlReference classes
â”‚   â””â”€â”€ validators.py              # Hardware, Linux, Software validators
â”œâ”€â”€ localplugins                   # Symlink â†’ .dotstop_extensions
â””â”€â”€ docs/
    â”œâ”€â”€ doorstop/                  # Published reports (generated by TruDAG)
    â”‚   â”œâ”€â”€ ASSERTIONS.md
    â”‚   â”œâ”€â”€ ASSUMPTIONS.md
    â”‚   â”œâ”€â”€ EVIDENCES.md
    â”‚   â”œâ”€â”€ EXPECTATIONS.md
    â”‚   â”œâ”€â”€ dashboard.md
    â”‚   â””â”€â”€ trustable_report_for_Software.md
    â”œâ”€â”€ sprints/                   # Sprint files (evidence source)
    â”‚   â”œâ”€â”€ sprint1.md ... sprint7.md
    â””â”€â”€ TSF/
        â”œâ”€â”€ requirements/
        â”‚   â””â”€â”€ tsf-requirements-table.md   # Source of truth for requirements
        â””â”€â”€ tsf_implementation/
            â”œâ”€â”€ .dotstop.dot               # TruDAG database (generated)
            â”œâ”€â”€ .dotstop_extensions        # Symlink â†’ ../../../.dotstop_extensions
            â”œâ”€â”€ .trudag_items/             # Generated trudag items
            â”œâ”€â”€ items/                     # SOURCE TSF items (editable)
            â”‚   â”œâ”€â”€ assertions/            # ASSERT-L0-X.md
            â”‚   â”œâ”€â”€ assumptions/           # ASSUMP-L0-X.md
            â”‚   â”œâ”€â”€ evidences/             # EVID-L0-X.md
            â”‚   â””â”€â”€ expectations/          # EXPECT-L0-X.md
            â”œâ”€â”€ graph/
            â”‚   â””â”€â”€ graph.dot              # Dependency graph (generated)
            â””â”€â”€ scripts/
                â”œâ”€â”€ open_check_sync_update_validate_run_publish_tsfrequirements.py
                â”œâ”€â”€ setup_trudag_clean.sh
                â”œâ”€â”€ config.yaml
                â””â”€â”€ modules/
```

---

## Quick Start Commands

### âš ï¸ IMPORTANT: Always activate the virtual environment first!

```bash
# Activate virtual environment (REQUIRED)
source .venv/bin/activate
```

### Main Commands

```bash
# Check current state (read-only, shows status of all requirements)
source .venv/bin/activate && python3 docs/TSF/tsf_implementation/scripts/open_check_sync_update_validate_run_publish_tsfrequirements.py --check

# Full validation + TruDAG run + publish reports
source .venv/bin/activate && python3 docs/TSF/tsf_implementation/scripts/open_check_sync_update_validate_run_publish_tsfrequirements.py --validate

# Sync changes (update items from table + AI generation if needed)
source .venv/bin/activate && python3 docs/TSF/tsf_implementation/scripts/open_check_sync_update_validate_run_publish_tsfrequirements.py --sync

# Run all stages
source .venv/bin/activate && python3 docs/TSF/tsf_implementation/scripts/open_check_sync_update_validate_run_publish_tsfrequirements.py --all
```

---

## Main Automation Script

**File:** `open_check_sync_update_validate_run_publish_tsfrequirements.py`

This unified script handles the complete TSF workflow:

### Script Options

| Flag | Description |
|------|-------------|
| `--check` | Verify table completeness, detect orphan files, validate content |
| `--sync` | Generate missing items, update content with AI |
| `--validate` | Run full validation, TruDAG setup, scoring, and publish |
| `--all` | Run all stages in sequence |

### What It Does

1. **Parses requirements table** (`tsf-requirements-table.md`)
2. **Detects new/removed requirements** (creates or flags orphan files)
3. **Syncs evidence from sprints** (extracts links from sprint files)
4. **Validates item content** (YAML structure, references)
5. **Runs TruDAG** (setup, score, publish)
6. **Generates reports** (in `docs/doorstop/`)

---

## Workflow Stages

### Stage 1: OPEN & CHECK (`--check`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ STEP 1: OPEN & CHECK                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Parse requirements table (tsf-requirements-table.md)    â”‚
â”‚ 2. Check for incomplete fields                             â”‚
â”‚ 3. Parse sprint files for evidence links                   â”‚
â”‚ 4. Check item files existence (EXPECT/ASSERT/EVID/ASSUMP)  â”‚
â”‚ 5. Validate content of existing items                      â”‚
â”‚ 6. Detect orphan files (items without table entry)         â”‚
â”‚ 7. Identify sync needs                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Orphan Detection:** If a requirement is removed from the table, the script detects orphan files and prompts for confirmation before deletion.

### Stage 2: SYNC & UPDATE (`--sync`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”„ STEP 2: SYNC & UPDATE                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Generate missing item files (skeleton structure)        â”‚
â”‚ 2. Update EXPECT headers from table                        â”‚
â”‚ 3. Update EVID references from sprint evidence             â”‚
â”‚ 4. AI content generation (if enabled):                     â”‚
â”‚    - Option G: VSCode/Claude (semi-automated)              â”‚
â”‚    - Option C: gh copilot CLI (fallback)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Stage 3: VALIDATE, RUN & PUBLISH (`--validate`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… STEP 3: VALIDATE, RUN & PUBLISH                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Check required symlinks                                 â”‚
â”‚ 2. Run item validation (YAML structure)                    â”‚
â”‚ 3. Execute TruDAG (setup_trudag_clean.sh):                 â”‚
â”‚    - Clean generated files                                 â”‚
â”‚    - Generate graph.dot                                    â”‚
â”‚    - Initialize DB                                         â”‚
â”‚    - Create items in .trudag_items/                        â”‚
â”‚    - Apply logical links                                   â”‚
â”‚    - Mark items as reviewed                                â”‚
â”‚    - Run lint                                              â”‚
â”‚    - Calculate scores                                      â”‚
â”‚    - Publish reports                                       â”‚
â”‚ 4. Verify scores (report items below 1.0)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## TruDAG Integration

### setup_trudag_clean.sh

The canonical script for TruDAG operations:

```bash
bash docs/TSF/tsf_implementation/scripts/setup_trudag_clean.sh
```

**Steps performed:**
1. Clean all generated files (preserves `items/` source)
2. Generate `graph/graph.dot` from source items
3. Initialize trudag DB (`.dotstop.dot`)
4. Create items in `.trudag_items/` from source
5. Fix file reference paths and IDs
6. Create logical links from graph.dot
7. Mark all items as reviewed
8. Run `trudag lint`
9. Calculate scores (`trudag score --validate`)
10. Publish reports (`trudag publish`)

### Direct TruDAG Commands

```bash
# Run from tsf_implementation directory
cd docs/TSF/tsf_implementation

# Initialize database
trudag init

# Score with validators
trudag score --validate

# Publish reports
trudag publish --output-dir ../../../docs/doorstop --validate --all-bodies

# Lint validation
trudag lint
```

---

## Validators

### Structure Validators (CI)

**File:** `scripts/modules/validate_items_formatation.py`

Validates YAML structure in item files:
- Front-matter format
- Required fields presence
- Reference path validity

### Content Validators (TruDAG)

**File:** `.dotstop_extensions/validators.py`

| Validator | Purpose | Used By |
|-----------|---------|---------|
| `validate_hardware_availability` | Checks hardware components in repo | ASSUMP items |
| `validate_linux_environment` | Validates Linux tools/packages | ASSUMP items |
| `validate_software_dependencies` | Checks software dependencies | ASSUMP items |

### Validator Configuration Example

In ASSUMP items:

```yaml
evidence:
  type: validate_hardware_availability
  configuration:
    components:
      - "Raspberry Pi 5"
      - "STM32"
      - "CAN"
```

---

## Symlinks Explained

The project uses symlinks for trudag compatibility:

| Symlink | Target | Purpose |
|---------|--------|---------|
| `.dotstop.dot` (repo root) | `docs/TSF/tsf_implementation/.dotstop.dot` | TruDAG finds DB from repo root |
| `localplugins` (repo root) | `.dotstop_extensions` | TruDAG imports custom references |
| `.dotstop_extensions` (tsf_impl) | `../../../.dotstop_extensions` | Validators accessible from tsf_implementation |

---

## CI/CD Integration

### GitHub Actions Workflow

**File:** `.github/workflows/validate_items_formatation.yml`

Validates TSF items on PRs to `development`:
- Runs front-matter validation
- Checks YAML structure
- Validates reference paths

---

## Published Reports

Reports are generated in `docs/doorstop/`:

| File | Description |
|------|-------------|
| `ASSERTIONS.md` | All assertion items with scores |
| `ASSUMPTIONS.md` | All assumption items with scores |
| `EVIDENCES.md` | All evidence items with links |
| `EXPECTATIONS.md` | All expectation items |
| `dashboard.md` | Score distribution summary |
| `trustable_report_for_Software.md` | Full trustable report |

---

## Troubleshooting

### "source: no such file or directory: venv/bin/activate"

The project uses `.venv` (with dot), not `venv`:

```bash
# WRONG
source venv/bin/activate

# CORRECT
source .venv/bin/activate
```

### "Cannot find a validator function for type X"

Ensure symlinks exist:
```bash
# Check symlinks
ls -la .dotstop_extensions
ls -la localplugins
ls -la docs/TSF/tsf_implementation/.dotstop_extensions
```

### "Cannot get non-existent or non-regular file"

File path in references is incorrect. Paths should be:
- Relative to `items/` folder: `../assertions/ASSERT-L0-X.md`
- OR relative to repo root for actual files: `docs/demos/image.png`

### Items have score 0.0

Check:
1. Evidence files exist at referenced paths
2. Validators have proper configuration
3. No broken URL references

### TruDAG returns exit code 1

Usually caused by:
- Invalid references in items
- Missing files in references
- Validation errors

Run check first:
```bash
source .venv/bin/activate && python3 docs/TSF/tsf_implementation/scripts/open_check_sync_update_validate_run_publish_tsfrequirements.py --check
```

---

## Current Status (February 2026)

- **Total Requirements:** 30 (L0-1 to L0-30)
- **Total TSF Items:** 120 (30 Ã— 4 types)
- **Validated Items:** ~86 with score 1.0
- **Pending Items:** ~34 awaiting evidence/implementation

---

## Quick Reference

```bash
# Full workflow
source .venv/bin/activate
python3 docs/TSF/tsf_implementation/scripts/open_check_sync_update_validate_run_publish_tsfrequirements.py --all

# Just check status
source .venv/bin/activate
python3 docs/TSF/tsf_implementation/scripts/open_check_sync_update_validate_run_publish_tsfrequirements.py --check

# Just validate and publish
source .venv/bin/activate
python3 docs/TSF/tsf_implementation/scripts/open_check_sync_update_validate_run_publish_tsfrequirements.py --validate
```
